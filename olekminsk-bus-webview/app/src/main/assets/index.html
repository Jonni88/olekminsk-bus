<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–≤—Ç–æ–±—É—Å—ã –û–ª—ë–∫–º–∏–Ω—Å–∫–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #1976D2;
            --primary-dark: #1565C0;
            --secondary: #FFC107;
            --background: #f5f5f5;
            --card: #ffffff;
            --text: #333333;
            --text-secondary: #666666;
            --success: #4CAF50;
            --error: #f44336;
            --warning: #FF9800;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 48px;
            height: 48px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        
        .logo-text h1 {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }
        
        .logo-text p {
            font-size: 0.75rem;
            opacity: 0.9;
            margin: 0;
        }
        
        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.3s;
        }
        
        .user-avatar:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 4px rgba(25,118,210,0.3);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(25,118,210,0.4);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .btn-danger {
            background: #FFEBEE;
            color: #C62828;
        }
        
        .btn-danger:hover {
            background: #FFCDD2;
        }
        
        .btn-success {
            background: #E8F5E9;
            color: #2E7D32;
        }
        
        .btn-success:hover {
            background: #C8E6C9;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
        }
        
        /* Container */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Login Section */
        .login-section {
            min-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .login-card {
            background: var(--card);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .login-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        .login-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .password-field {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0.6;
        }
        
        /* User Profile */
        .profile-section {
            background: var(--card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            box-shadow: 0 4px 12px rgba(25,118,210,0.3);
        }
        
        .profile-info h2 {
            font-size: 1.5rem;
            margin-bottom: 4px;
        }
        
        .profile-info p {
            color: var(--text-secondary);
        }
        
        .profile-role {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 8px;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        /* Admin Panel */
        .admin-panel {
            background: var(--card);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .panel-title {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }
        
        .admin-btn {
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        
        .admin-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .admin-btn-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .admin-btn-text {
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .admin-btn-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        /* Announcements */
        .section {
            background: var(--card);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .announcement-card {
            background: linear-gradient(135deg, #FFF8E1 0%, #FFECB3 100%);
            border-left: 5px solid var(--secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 12px;
            position: relative;
            transition: all 0.3s;
        }
        
        .announcement-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .announcement-card.urgent {
            background: linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 100%);
            border-left-color: var(--error);
        }
        
        .announcement-card.info {
            background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
            border-left-color: var(--primary);
        }
        
        .announcement-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .announcement-title {
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .announcement-badge {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .badge-urgent {
            background: var(--error);
            color: white;
        }
        
        .badge-info {
            background: var(--primary);
            color: white;
        }
        
        .announcement-text {
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .announcement-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0,0,0,0.1);
        }
        
        .announcement-date {
            font-size: 0.8rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .announcement-actions {
            display: flex;
            gap: 8px;
        }
        
        /* Routes */
        .route-card {
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .route-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            border-color: var(--primary);
        }
        
        .route-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            flex-shrink: 0;
        }
        
        .route-info {
            flex: 1;
        }
        
        .route-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .route-name {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .route-meta {
            display: flex;
            gap: 16px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .route-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .route-arrow {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--primary);
        }
        
        /* Route Detail */
        .route-detail {
            background: var(--card);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }
        
        .detail-title-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .detail-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
        }
        
        .detail-actions {
            display: flex;
            gap: 8px;
        }
        
        /* Schedule Toggle */
        .schedule-toggle {
            display: flex;
            background: #f5f5f5;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 24px;
        }
        
        .toggle-btn {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            background: transparent;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .toggle-btn.active {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            color: var(--primary);
        }
        
        /* Next Bus */
        .next-bus-card {
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            margin-bottom: 24px;
        }
        
        .next-bus-card.no-bus {
            background: linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 100%);
        }
        
        .next-bus-label {
            font-size: 0.9rem;
            color: #2E7D32;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .next-bus-card.no-bus .next-bus-label {
            color: #C62828;
        }
        
        .next-bus-time {
            font-size: 3rem;
            font-weight: 700;
            color: #1B5E20;
        }
        
        .next-bus-card.no-bus .next-bus-time {
            font-size: 1.5rem;
            color: #C62828;
        }
        
        /* Stops */
        .stops-list {
            margin-bottom: 24px;
        }
        
        .stop-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s;
        }
        
        .stop-item:hover {
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .stop-number {
            width: 36px;
            height: 36px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 16px;
        }
        
        .stop-icon {
            font-size: 20px;
            margin-right: 12px;
        }
        
        /* Times Grid */
        .times-section {
            margin-bottom: 24px;
        }
        
        .times-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
        }
        
        .time-item {
            padding: 12px 8px;
            text-align: center;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .time-item.future {
            background: #E3F2FD;
            color: var(--primary);
        }
        
        .time-item.past {
            background: #f5f5f5;
            color: #999;
        }
        
        .time-item:hover {
            transform: scale(1.05);
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            backdrop-filter: blur(4px);
        }
        
        .modal {
            background: var(--card);
            border-radius: 24px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            padding: 24px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .modal-close {
            width: 40px;
            height: 40px;
            border: none;
            background: #f5f5f5;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: #e0e0e0;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .modal-footer {
            padding: 20px 24px;
            border-top: 2px solid #f0f0f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }
        
        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
        }
        
        .form-hint {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 6px;
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s;
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            background: var(--success);
        }
        
        .toast.error {
            background: var(--error);
        }
        
        /* Hidden */
        .hidden {
            display: none !important;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-text {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .profile-stats {
                grid-template-columns: 1fr;
            }
            
            .admin-grid {
                grid-template-columns: 1fr;
            }
            
            .times-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .route-meta {
                flex-direction: column;
                gap: 4px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-section">
        <div class="login-card animate-fade-in">
            <div class="login-icon">üöå</div>
            <h2 class="login-title">–ê–≤—Ç–æ–±—É—Å—ã –û–ª—ë–∫–º–∏–Ω—Å–∫–∞</h2>
            <p class="login-subtitle">–í–æ–π–¥–∏—Ç–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é</p>
            
            <div class="form-group">
                <label class="form-label">–õ–æ–≥–∏–Ω</label>
                <input type="text" id="loginUsername" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
            </div>
            
            <div class="form-group">
                <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                <div class="password-field">
                    <input type="password" id="loginPassword" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                    <button type="button" class="toggle-password" onclick="togglePasswordVisibility()">üëÅÔ∏è</button>
                </div>
            </div>
            
            <button class="btn btn-primary" style="width: 100%;" onclick="login()">–í–æ–π—Ç–∏</button>
            
            <p style="margin-top: 20px; font-size: 0.85rem; color: #666;">
                üîë –î–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞: –ª–æ–≥–∏–Ω <strong>admin</strong>, –ø–∞—Ä–æ–ª—å <strong>admin</strong>
            </p>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <header class="header">
            <div class="header-content">
                <div class="logo" onclick="showMainScreen()" style="cursor: pointer;">
                    <div class="logo-icon">üöå</div>
                    <div class="logo-text">
                        <h1>–ê–≤—Ç–æ–±—É—Å—ã –û–ª—ë–∫–º–∏–Ω—Å–∫–∞</h1>
                        <p>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ –º–∞—Ä—à—Ä—É—Ç—ã</p>
                    </div>
                </div>
                <div class="header-actions">
                    <div class="user-avatar" onclick="showProfile()" title="–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç">üë§</div>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- Profile Section -->
            <div id="profileSection" class="profile-section hidden">
                <div class="profile-header">
                    <div class="profile-avatar">üë§</div>
                    <div class="profile-info">
                        <h2 id="profileUsername">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</h2>
                        <p id="profileRole">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã</p>
                        <span class="profile-role">üéõÔ∏è –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø</span>
                    </div>
                </div>
                
                <div class="profile-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="statRoutes">5</div>
                        <div class="stat-label">–ú–∞—Ä—à—Ä—É—Ç–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statAnnouncements">0</div>
                        <div class="stat-label">–û–±—ä—è–≤–ª–µ–Ω–∏–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statLastLogin">‚Äî</div>
                        <div class="stat-label">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="showChangePasswordModal()">üîë –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                    <button class="btn btn-secondary" onclick="showMainScreen()">‚Üê –ù–∞–∑–∞–¥</button>
                    <button class="btn btn-danger" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="adminPanel" class="admin-panel hidden">
                <div class="panel-header">
                    <div class="panel-title">üéõÔ∏è –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
                    <button class="modal-close" onclick="hideAdminPanel()">√ó</button>
                </div>
                
                <div class="admin-grid">
                    <button class="admin-btn" onclick="showAddRouteModal()">
                        <div class="admin-btn-icon">‚ûï</div>
                        <div class="admin-btn-text">–ú–∞—Ä—à—Ä—É—Ç</div>
                        <div class="admin-btn-desc">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π</div>
                    </button>
                    
                    <button class="admin-btn" onclick="showAddAnnouncementModal()">
                        <div class="admin-btn-icon">üì¢</div>
                        <div class="admin-btn-text">–û–±—ä—è–≤–ª–µ–Ω–∏–µ</div>
                        <div class="admin-btn-desc">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ</div>
                    </button>
                    
                    <button class="admin-btn" onclick="exportData()">
                        <div class="admin-btn-icon">üíæ</div>
                        <div class="admin-btn-text">–≠–∫—Å–ø–æ—Ä—Ç</div>
                        <div class="admin-btn-desc">–°–∫–∞—á–∞—Ç—å JSON</div>
                    </button>
                    
                    <button class="admin-btn" onclick="document.getElementById('importFile').click()">
                        <div class="admin-btn-icon">üìÇ</div>
                        <div class="admin-btn-text">–ò–º–ø–æ—Ä—Ç</div>
                        <div class="admin-btn-desc">–ó–∞–≥—Ä—É–∑–∏—Ç—å JSON</div>
                    </button>
                    
                    <button class="admin-btn" onclick="showAdminLogs()">
                        <div class="admin-btn-icon">üìã</div>
                        <div class="admin-btn-text">–ñ—É—Ä–Ω–∞–ª</div>
                        <div class="admin-btn-desc">–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π</div>
                    </button>
                    
                    <button class="admin-btn" onclick="resetData()">
                        <div class="admin-btn-icon">üîÑ</div>
                        <div class="admin-btn-text">–°–±—Ä–æ—Å</div>
                        <div class="admin-btn-desc">–ö –Ω–∞—á–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º</div>
                    </button>
                </div>
                
                <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(this)">
            </div>

            <!-- Main Screen -->
            <div id="mainScreen">
                <!-- Quick Actions -->
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="showAdminPanel()">‚öôÔ∏è –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</button>
                </div>

                <!-- Announcements -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">üì¢ –û–±—ä—è–≤–ª–µ–Ω–∏—è</div>
                        <button class="btn btn-secondary btn-small" onclick="showAddAnnouncementModal()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                    <div id="announcementsList">
                        <div class="empty-state">
                            <div class="empty-icon">üì≠</div>
                            <p class="empty-text">–ù–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>
                        </div>
                    </div>
                </div>

                <!-- Routes -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">üöå –ú–∞—Ä—à—Ä—É—Ç—ã</div>
                    </div>
                    <div id="routesList"></div>
                </div>
            </div>

            <!-- Route Detail -->
            <div id="routeDetail" class="hidden"></div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle" class="modal-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div id="modalBody" class="modal-body"></div>
            <div id="modalFooter" class="modal-footer"></div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <script>
        // Default data
        const defaultRoutes = [
            {
                id: 1,
                number: "1",
                name: "–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª ‚Äî –î–∞—á–∞",
                interval: "20-25 –º–∏–Ω",
                weekday: {
                    start: "07:00",
                    end: "21:07",
                    times: ["07:00", "07:42", "07:59", "08:32", "08:49", "10:07", "10:32", "10:57", "11:47", "12:37", "13:27", "14:17", "16:07", "16:57", "17:47", "18:37", "19:27", "20:17", "21:07"]
                },
                weekend: {
                    start: "07:00",
                    end: "20:42",
                    times: ["07:00", "07:34", "07:50", "08:24", "08:40", "09:30", "09:57", "10:47", "11:22", "12:12", "13:02", "13:52", "14:42", "15:32", "16:32", "17:22", "18:12", "19:02", "19:27", "20:42"]
                },
                stops: ["–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª", "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å", "–®–∫–æ–ª–∞ ‚Ññ2", "–î–∞—á–∞"]
            },
            {
                id: 2,
                number: "2",
                name: "–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª ‚Äî –ê–≤–∏–∞–ø–æ—Ä—Ç",
                interval: "40-60 –º–∏–Ω",
                weekday: {
                    start: "07:00",
                    end: "20:30",
                    times: ["07:00", "07:40", "08:20", "09:30", "11:00", "12:20", "13:00", "13:40", "14:40", "16:40", "17:40", "18:00", "18:40", "19:00", "20:10", "20:30"]
                },
                weekend: {
                    start: "07:40",
                    end: "20:30",
                    times: ["07:40", "08:20", "12:20", "13:00", "13:40", "14:40", "16:40", "17:20", "18:00", "18:40", "19:00", "20:10", "20:30"]
                },
                stops: ["–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª", "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ä—ã–Ω–æ–∫", "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç", "–ê–≤–∏–∞–ø–æ—Ä—Ç"]
            },
            {
                id: 5,
                number: "5",
                name: "–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª ‚Äî –ü–ù–î–ò",
                interval: "25-35 –º–∏–Ω",
                weekday: {
                    start: "07:25",
                    end: "20:17",
                    times: ["07:25", "08:15", "09:05", "09:42", "11:22", "12:12", "13:02", "13:52", "14:42", "15:42", "16:32", "17:22", "18:12", "19:02", "20:17"]
                },
                weekend: {
                    start: "07:25",
                    end: "19:52",
                    times: ["07:25", "08:15", "09:05", "10:32", "11:22", "12:12", "13:02", "13:52", "15:42", "16:32", "17:22", "18:12", "19:02", "19:52"]
                },
                stops: ["–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª", "–®–∫–æ–ª–∞ ‚Ññ3", "–ü–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞", "–ü–ù–î–ò"]
            },
            {
                id: 6,
                number: "6",
                name: "–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª ‚Äî –ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏ ‚Äî –ü–æ–ø–æ–≤—Å–∫–∏–µ –ø–æ–ª—è",
                interval: "30-90 –º–∏–Ω",
                weekday: {
                    start: "07:20",
                    end: "18:10",
                    times: ["07:20", "08:15", "12:30", "13:30", "15:00", "17:00", "18:10"]
                },
                weekend: {
                    start: "07:20",
                    end: "13:30",
                    times: ["07:20", "12:30", "13:30"]
                },
                stops: ["–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª", "–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏", "–ü–æ–ø–æ–≤—Å–∫–∏–µ –ø–æ–ª—è"]
            },
            {
                id: 7,
                number: "7",
                name: "–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª ‚Äî –ù–µ—Ñ—Ç–µ–±–∞–∑–∞",
                interval: "60-90 –º–∏–Ω",
                weekday: {
                    start: "07:05",
                    end: "18:35",
                    times: ["07:05", "08:55", "12:30", "14:30", "16:20", "17:55"]
                },
                weekend: {
                    start: "07:15",
                    end: "15:10",
                    times: ["07:15", "12:30", "14:30"]
                },
                stops: ["–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª", "–ü—Ä–æ–º–∑–æ–Ω–∞", "–ù–µ—Ñ—Ç–µ–±–∞–∑–∞"]
            }
        ];

        // State
        let routes = [];
        let announcements = [];
        let currentRoute = null;
        let currentUser = null;
        let adminLogs = [];

        // Initialize
        function init() {
            loadData();
            checkAuth();
        }

        // Check authentication
        function checkAuth() {
            const user = localStorage.getItem('busAppUser');
            if (user) {
                currentUser = JSON.parse(user);
                showMainApp();
            } else {
                showLoginScreen();
            }
        }

        // Show login screen
        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        // Show main app
        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            renderRoutes();
            renderAnnouncements();
            updateStats();
        }

        // Login
        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showToast('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å', 'error');
                return;
            }
            
            // Check stored user or default
            const storedUser = localStorage.getItem('busAppCredentials');
            let validLogin = false;
            
            if (storedUser) {
                const creds = JSON.parse(storedUser);
                if (creds.username === username && creds.password === hashPassword(password)) {
                    validLogin = true;
                }
            } else if (username === 'admin' && password === 'admin') {
                validLogin = true;
                // Save default credentials
                localStorage.setItem('busAppCredentials', JSON.stringify({
                    username: 'admin',
                    password: hashPassword('admin')
                }));
            }
            
            if (validLogin) {
                currentUser = { username, role: 'admin', loginTime: new Date().toISOString() };
                localStorage.setItem('busAppUser', JSON.stringify(currentUser));
                addLog('–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É', username);
                showMainApp();
                showToast('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', 'success');
            } else {
                showToast('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
            }
        }

        // Logout
        function logout() {
            addLog('–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', currentUser?.username);
            currentUser = null;
            localStorage.removeItem('busAppUser');
            showLoginScreen();
            showToast('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
        }

        // Hash password (simple)
        function hashPassword(password) {
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString();
        }

        // Toggle password visibility
        function togglePasswordVisibility() {
            const input = document.getElementById('loginPassword');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        // Show profile
        function showProfile() {
            hideAllScreens();
            document.getElementById('profileSection').classList.remove('hidden');
            document.getElementById('profileUsername').textContent = currentUser?.username || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
            document.getElementById('statLastLogin').textContent = currentUser?.loginTime ? 
                new Date(currentUser.loginTime).toLocaleDateString('ru-RU') : '‚Äî';
            updateStats();
        }

        // Update stats
        function updateStats() {
            document.getElementById('statRoutes').textContent = routes.length;
            document.getElementById('statAnnouncements').textContent = announcements.length;
        }

        // Show change password modal
        function showChangePasswordModal() {
            const body = `
                <div class="form-group">
                    <label class="form-label">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" id="currentPassword" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" id="newPassword" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" id="confirmPassword" class="form-input">
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="changePassword()">–°–º–µ–Ω–∏—Ç—å</button>
            `;
            
            showModal('üîë –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è', body, footer);
        }

        // Change password
        function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if (!current || !newPass || !confirm) {
                showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            if (newPass !== confirm) {
                showToast('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', 'error');
                return;
            }
            
            const storedUser = localStorage.getItem('busAppCredentials');
            if (storedUser) {
                const creds = JSON.parse(storedUser);
                if (creds.password !== hashPassword(current)) {
                    showToast('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å', 'error');
                    return;
                }
            }
            
            localStorage.setItem('busAppCredentials', JSON.stringify({
                username: currentUser.username,
                password: hashPassword(newPass)
            }));
            
            addLog('–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è', currentUser.username);
            closeModal();
            showToast('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω', 'success');
        }

        // Hide all screens
        function hideAllScreens() {
            document.getElementById('mainScreen').classList.add('hidden');
            document.getElementById('routeDetail').classList.add('hidden');
            document.getElementById('profileSection').classList.add('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
        }

        // Show main screen
        function showMainScreen() {
            hideAllScreens();
            document.getElementById('mainScreen').classList.remove('hidden');
            renderRoutes();
            renderAnnouncements();
        }

        // Show admin panel
        function showAdminPanel() {
            hideAllScreens();
            document.getElementById('adminPanel').classList.remove('hidden');
        }

        function hideAdminPanel() {
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');
        }

        // Load data
        function loadData() {
            const savedRoutes = localStorage.getItem('busRoutes');
            const savedAnnouncements = localStorage.getItem('busAnnouncements');
            const savedLogs = localStorage.getItem('busAdminLogs');
            
            routes = savedRoutes ? JSON.parse(savedRoutes) : [...defaultRoutes];
            announcements = savedAnnouncements ? JSON.parse(savedAnnouncements) : [];
            adminLogs = savedLogs ? JSON.parse(savedLogs) : [];
        }

        // Save data
        function saveData() {
            localStorage.setItem('busRoutes', JSON.stringify(routes));
            localStorage.setItem('busAnnouncements', JSON.stringify(announcements));
            localStorage.setItem('busAdminLogs', JSON.stringify(adminLogs));
        }

        // Add log
        function addLog(action, details = '') {
            adminLogs.unshift({
                action,
                details,
                timestamp: new Date().toISOString(),
                user: currentUser?.username || 'system'
            });
            saveData();
        }

        // Render routes
        function renderRoutes() {
            const container = document.getElementById('routesList');
            if (routes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üöå</div>
                        <p class="empty-text">–ù–µ—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = routes.map(route => `
                <div class="route-card" onclick="showRouteDetail(${route.id})">
                    <div class="route-icon">üöå</div>
                    <div class="route-info">
                        <div class="route-number">–ú–∞—Ä—à—Ä—É—Ç ${route.number}</div>
                        <div class="route-name">${route.name}</div>
                        <div class="route-meta">
                            <span>‚è±Ô∏è ${route.interval}</span>
                            <span>üöè ${route.stops.length} –æ—Å—Ç–∞–Ω–æ–≤–æ–∫</span>
                        </div>
                    </div>
                    <div class="route-arrow">‚Ä∫</div>
                </div>
            `).join('');
        }

        // Render announcements
        function renderAnnouncements() {
            const container = document.getElementById('announcementsList');
            
            if (announcements.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <p class="empty-text">–ù–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = announcements.map((ann, index) => `
                <div class="announcement-card ${ann.type || ''}">
                    <div class="announcement-header">
                        <div class="announcement-title">
                            ${ann.type === 'urgent' ? 'üî¥' : ann.type === 'info' ? 'üîµ' : 'üì¢'}
                            ${ann.title}
                            ${ann.type ? `<span class="announcement-badge badge-${ann.type}">${ann.type === 'urgent' ? '–°—Ä–æ—á–Ω–æ' : '–ò–Ω—Ñ–æ'}</span>` : ''}
                        </div>
                    </div>
                    <div class="announcement-text">${ann.text}</div>
                    <div class="announcement-footer">
                        <div class="announcement-date">
                            üìÖ ${ann.date}
                            ${ann.author ? `‚Ä¢ üë§ ${ann.author}` : ''}
                        </div>
                        <div class="announcement-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteAnnouncement(${index}); event.stopPropagation();">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Show route detail
        function showRouteDetail(routeId) {
            currentRoute = routes.find(r => r.id === routeId);
            if (!currentRoute) return;

            hideAllScreens();
            
            const detail = document.getElementById('routeDetail');
            detail.classList.remove('hidden');
            
            renderRouteDetail();
        }

        // Render route detail
        function renderRouteDetail(isWeekend = false) {
            if (!currentRoute) return;
            
            const schedule = isWeekend ? currentRoute.weekend : currentRoute.weekday;
            const nextBus = findNextBus(schedule.times);
            
            const container = document.getElementById('routeDetail');
            container.innerHTML = `
                <div class="route-detail">
                    <div class="detail-header">
                        <div class="detail-title-section">
                            <div class="detail-icon">üöå</div>
                            <div>
                                <h2>–ú–∞—Ä—à—Ä—É—Ç ${currentRoute.number}</h2>
                                <p style="color: #666;">${currentRoute.name}</p>
                            </div>
                        </div>
                        <div class="detail-actions">
                            <button class="btn btn-secondary btn-small" onclick="showEditRouteModal()">‚úèÔ∏è</button>
                            <button class="btn btn-danger btn-small" onclick="deleteRoute()">üóëÔ∏è</button>
                        </div>
                    </div>
                    
                    <div class="schedule-toggle">
                        <button class="toggle-btn ${!isWeekend ? 'active' : ''}" onclick="renderRouteDetail(false)">
                            üìÖ –ë—É–¥–Ω–∏
                        </button>
                        <button class="toggle-btn ${isWeekend ? 'active' : ''}" onclick="renderRouteDetail(true)">
                            üéâ –í—ã—Ö–æ–¥–Ω—ã–µ
                        </button>
                    </div>
                    
                    ${nextBus ? `
                        <div class="next-bus-card">
                            <div class="next-bus-label">
                                üïê –ë–ª–∏–∂–∞–π—à–∏–π –∞–≤—Ç–æ–±—É—Å
                            </div>
                            <div class="next-bus-time">${nextBus}</div>
                        </div>
                    ` : `
                        <div class="next-bus-card no-bus">
                            <div class="next-bus-label">
                                üö´ –ù–∞ —Å–µ–≥–æ–¥–Ω—è –∞–≤—Ç–æ–±—É—Å–æ–≤ –±–æ–ª—å—à–µ –Ω–µ—Ç
                            </div>
                        </div>
                    `}
                    
                    <div class="stops-list">
                        <h3 style="margin-bottom: 16px; color: #424242;">üöè –û—Å—Ç–∞–Ω–æ–≤–∫–∏</h3>
                        ${currentRoute.stops.map((stop, i) => `
                            <div class="stop-item">
                                <div class="stop-number">${i + 1}</div>
                                <div class="stop-icon">üìç</div>
                                <div>${stop}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="times-section">
                        <h3 style="margin-bottom: 16px; color: #424242;">üïê –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
                        <div class="times-grid">
                            ${schedule.times.map(time => {
                                const isPast = isTimePast(time);
                                return `<div class="time-item ${isPast ? 'past' : 'future'}">${time}</div>`;
                            }).join('')}
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" style="width: 100%; margin-top: 24px;" onclick="showMainScreen()">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                    </button>
                </div>
            `;
        }

        // Check if time is past
        function isTimePast(timeStr) {
            const now = new Date();
            const [hours, minutes] = timeStr.split(':').map(Number);
            const time = new Date();
            time.setHours(hours, minutes, 0);
            return time < now;
        }

        // Find next bus
        function findNextBus(times) {
            const now = new Date();
            for (const timeStr of times) {
                const [hours, minutes] = timeStr.split(':').map(Number);
                const time = new Date();
                time.setHours(hours, minutes, 0);
                if (time >= now) return timeStr;
            }
            return null;
        }

        // Modal functions
        function showModal(title, body, footer) {
            document.getElementById('modalTitle').innerHTML = title;
            document.getElementById('modalBody').innerHTML = body;
            document.getElementById('modalFooter').innerHTML = footer;
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Add route modal
        function showAddRouteModal() {
            const body = `
                <div class="form-group">
                    <label class="form-label">–ù–æ–º–µ—Ä –º–∞—Ä—à—Ä—É—Ç–∞ *</label>
                    <input type="text" id="routeNumber" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 8">
                </div>
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                    <input type="text" id="routeName" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª ‚Äî –ë–æ–ª—å–Ω–∏—Ü–∞">
                </div>
                <div class="form-group">
                    <label class="form-label">–ò–Ω—Ç–µ—Ä–≤–∞–ª</label>
                    <input type="text" id="routeInterval" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 20-30 –º–∏–Ω">
                </div>
                <div class="form-group">
                    <label class="form-label">–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–±—É–¥–Ω–∏) *</label>
                    <textarea id="weekdayTimes" class="form-textarea" placeholder="07:00, 07:30, 08:00..."></textarea>
                    <div class="form-hint">–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</div>
                </div>
                <div class="form-group">
                    <label class="form-label">–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–≤—ã—Ö–æ–¥–Ω—ã–µ) *</label>
                    <textarea id="weekendTimes" class="form-textarea" placeholder="08:00, 09:00, 10:00..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">–û—Å—Ç–∞–Ω–æ–≤–∫–∏ *</label>
                    <textarea id="routeStops" class="form-textarea" placeholder="–û—Å—Ç–∞–Ω–æ–≤–∫–∞ 1, –û—Å—Ç–∞–Ω–æ–≤–∫–∞ 2, –û—Å—Ç–∞–Ω–æ–≤–∫–∞ 3..."></textarea>
                    <div class="form-hint">–í–≤–µ–¥–∏—Ç–µ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</div>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveNewRoute()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            `;
            
            showModal('‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç', body, footer);
        }

        // Save new route
        function saveNewRoute() {
            const number = document.getElementById('routeNumber').value.trim();
            const name = document.getElementById('routeName').value.trim();
            const interval = document.getElementById('routeInterval').value.trim();
            const weekdayTimesStr = document.getElementById('weekdayTimes').value.trim();
            const weekendTimesStr = document.getElementById('weekendTimes').value.trim();
            const stopsStr = document.getElementById('routeStops').value.trim();
            
            if (!number || !name || !weekdayTimesStr || !stopsStr) {
                showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            const weekdayTimes = weekdayTimesStr.split(',').map(t => t.trim()).filter(t => t);
            const weekendTimes = weekendTimesStr.split(',').map(t => t.trim()).filter(t => t);
            const stops = stopsStr.split(',').map(s => s.trim()).filter(s => s);
            
            const newRoute = {
                id: Date.now(),
                number,
                name,
                interval: interval || '‚Äî',
                weekday: {
                    start: weekdayTimes[0] || '‚Äî',
                    end: weekdayTimes[weekdayTimes.length - 1] || '‚Äî',
                    times: weekdayTimes
                },
                weekend: {
                    start: weekendTimes[0] || '‚Äî',
                    end: weekendTimes[weekendTimes.length - 1] || '‚Äî',
                    times: weekendTimes
                },
                stops
            };
            
            routes.push(newRoute);
            saveData();
            addLog('–î–æ–±–∞–≤–ª–µ–Ω –º–∞—Ä—à—Ä—É—Ç', `‚Ññ${number} - ${name}`);
            renderRoutes();
            updateStats();
            closeModal();
            showToast('–ú–∞—Ä—à—Ä—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
        }

        // Edit route modal
        function showEditRouteModal() {
            if (!currentRoute) return;
            
            const body = `
                <div class="form-group">
                    <label class="form-label">–ù–æ–º–µ—Ä –º–∞—Ä—à—Ä—É—Ç–∞</label>
                    <input type="text" id="editRouteNumber" class="form-input" value="${currentRoute.number}">
                </div>
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="editRouteName" class="form-input" value="${currentRoute.name}">
                </div>
                <div class="form-group">
                    <label class="form-label">–ò–Ω—Ç–µ—Ä–≤–∞–ª</label>
                    <input type="text" id="editRouteInterval" class="form-input" value="${currentRoute.interval}">
                </div>
                <div class="form-group">
                    <label class="form-label">–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–±—É–¥–Ω–∏)</label>
                    <textarea id="editWeekdayTimes" class="form-textarea">${currentRoute.weekday.times.join(', ')}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–≤—ã—Ö–æ–¥–Ω—ã–µ)</label>
                    <textarea id="editWeekendTimes" class="form-textarea">${currentRoute.weekend.times.join(', ')}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">–û—Å—Ç–∞–Ω–æ–≤–∫–∏</label>
                    <textarea id="editRouteStops" class="form-textarea">${currentRoute.stops.join(', ')}</textarea>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="updateRoute()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            `;
            
            showModal('‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç', body, footer);
        }

        // Update route
        function updateRoute() {
            if (!currentRoute) return;
            
            const number = document.getElementById('editRouteNumber').value.trim();
            const name = document.getElementById('editRouteName').value.trim();
            const interval = document.getElementById('editRouteInterval').value.trim();
            const weekdayTimesStr = document.getElementById('editWeekdayTimes').value.trim();
            const weekendTimesStr = document.getElementById('editWeekendTimes').value.trim();
            const stopsStr = document.getElementById('editRouteStops').value.trim();
            
            const weekdayTimes = weekdayTimesStr.split(',').map(t => t.trim()).filter(t => t);
            const weekendTimes = weekendTimesStr.split(',').map(t => t.trim()).filter(t => t);
            const stops = stopsStr.split(',').map(s => s.trim()).filter(s => s);
            
            currentRoute.number = number;
            currentRoute.name = name;
            currentRoute.interval = interval;
            currentRoute.weekday = {
                start: weekdayTimes[0] || '‚Äî',
                end: weekdayTimes[weekdayTimes.length - 1] || '‚Äî',
                times: weekdayTimes
            };
            currentRoute.weekend = {
                start: weekendTimes[0] || '‚Äî',
                end: weekendTimes[weekendTimes.length - 1] || '‚Äî',
                times: weekendTimes
            };
            currentRoute.stops = stops;
            
            saveData();
            addLog('–û–±–Ω–æ–≤–ª–µ–Ω –º–∞—Ä—à—Ä—É—Ç', `‚Ññ${number} - ${name}`);
            renderRouteDetail();
            renderRoutes();
            closeModal();
            showToast('–ú–∞—Ä—à—Ä—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
        }

        // Delete route
        function deleteRoute() {
            if (!currentRoute) return;
            
            if (!confirm('‚ùì –£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞—Ä—à—Ä—É—Ç?')) return;
            
            routes = routes.filter(r => r.id !== currentRoute.id);
            saveData();
            addLog('–£–¥–∞–ª–µ–Ω –º–∞—Ä—à—Ä—É—Ç', `‚Ññ${currentRoute.number} - ${currentRoute.name}`);
            showMainScreen();
            renderRoutes();
            updateStats();
            showToast('–ú–∞—Ä—à—Ä—É—Ç —É–¥–∞–ª–µ–Ω', 'success');
        }

        // Add announcement modal
        function showAddAnnouncementModal() {
            const body = `
                <div class="form-group">
                    <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ *</label>
                    <input type="text" id="annTitle" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è">
                </div>
                <div class="form-group">
                    <label class="form-label">–¢–µ–∫—Å—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è *</label>
                    <textarea id="annText" class="form-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">–¢–∏–ø –æ–±—ä—è–≤–ª–µ–Ω–∏—è</label>
                    <select id="annType" class="form-input">
                        <option value="">–û–±—ã—á–Ω–æ–µ</option>
                        <option value="urgent">üî¥ –°—Ä–æ—á–Ω–æ–µ</option>
                        <option value="info">üîµ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</option>
                    </select>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveAnnouncement()">üì¢ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            `;
            
            showModal('üì¢ –ù–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ', body, footer);
        }

        // Save announcement
        function saveAnnouncement() {
            const title = document.getElementById('annTitle').value.trim();
            const text = document.getElementById('annText').value.trim();
            const type = document.getElementById('annType').value;
            
            if (!title || !text) {
                showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç', 'error');
                return;
            }
            
            const announcement = {
                title,
                text,
                type,
                date: new Date().toLocaleDateString('ru-RU'),
                author: currentUser?.username
            };
            
            announcements.unshift(announcement);
            saveData();
            addLog('–î–æ–±–∞–≤–ª–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ', title);
            renderAnnouncements();
            updateStats();
            closeModal();
            showToast('–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!', 'success');
        }

        // Delete announcement
        function deleteAnnouncement(index) {
            if (!confirm('‚ùì –£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?')) return;
            
            const ann = announcements[index];
            announcements.splice(index, 1);
            saveData();
            addLog('–£–¥–∞–ª–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ', ann.title);
            renderAnnouncements();
            updateStats();
            showToast('–û–±—ä—è–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
        }

        // Show admin logs
        function showAdminLogs() {
            const body = adminLogs.length === 0 ? 
                '<p style="text-align: center; color: #999;">–ñ—É—Ä–Ω–∞–ª –ø—É—Å—Ç</p>' :
                `<div style="max-height: 400px; overflow-y: auto;">
                    ${adminLogs.map(log => `
                        <div style="padding: 12px; border-bottom: 1px solid #eee;">
                            <div style="font-weight: 500;">${log.action}</div>
                            ${log.details ? `<div style="font-size: 0.9rem; color: #666;">${log.details}</div>` : ''}
                            <div style="font-size: 0.8rem; color: #999; margin-top: 4px;">
                                ${new Date(log.timestamp).toLocaleString('ru-RU')} ‚Ä¢ ${log.user}
                            </div>
                        </div>
                    `).join('')}
                </div>`;
            
            const footer = `
                <button class="btn btn-secondary" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button class="btn btn-danger" onclick="clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            `;
            
            showModal('üìã –ñ—É—Ä–Ω–∞–ª –¥–µ–π—Å—Ç–≤–∏–π', body, footer);
        }

        // Clear logs
        function clearLogs() {
            if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –∂—É—Ä–Ω–∞–ª?')) return;
            adminLogs = [];
            saveData();
            showAdminLogs();
            showToast('–ñ—É—Ä–Ω–∞–ª –æ—á–∏—â–µ–Ω', 'success');
        }

        // Export data
        function exportData() {
            const data = {
                routes,
                announcements,
                adminLogs,
                exportDate: new Date().toISOString(),
                exportedBy: currentUser?.username
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bus-schedule-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            addLog('–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö', `–§–∞–π–ª: ${a.download}`);
            showToast('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
        }

        // Import data
        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.routes) {
                        routes = data.routes;
                    }
                    if (data.announcements) {
                        announcements = data.announcements;
                    }
                    if (data.adminLogs) {
                        adminLogs = [...data.adminLogs, ...adminLogs];
                    }
                    
                    saveData();
                    addLog('–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö', `–§–∞–π–ª: ${file.name}`);
                    renderRoutes();
                    renderAnnouncements();
                    updateStats();
                    showToast('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', 'success');
                } catch (err) {
                    showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + err.message, 'error');
                }
            };
            reader.readAsText(file);
            input.value = '';
        }

        // Reset data
        function resetData() {
            if (!confirm('‚ö†Ô∏è –°–±—Ä–æ—Å–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –∫ –Ω–∞—á–∞–ª—å–Ω—ã–º? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è!')) return;
            
            routes = [...defaultRoutes];
            announcements = [];
            adminLogs = [];
            saveData();
            addLog('–°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö', '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è');
            renderRoutes();
            renderAnnouncements();
            updateStats();
            showMainScreen();
            showToast('–î–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã', 'success');
        }

        // Close modal on overlay click
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') closeModal();
        });

        // Handle Enter key in login form
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('loginPassword')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') login();
            });
        });

        // Initialize
        init();
    </script>
</body>
</html>