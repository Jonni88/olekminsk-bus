<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR –û–ª—ë–∫–º–∏–Ω—Å–∫ - –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —ç–∫—Å–∫—É—Ä—Å–∏–∏</title>
    
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- AR.js -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            background: #000;
        }
        
        /* UI –û–≤–µ—Ä–ª–µ–π */
        .ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            pointer-events: none;
        }
        
        .ui-overlay > * {
            pointer-events: auto;
        }
        
        /* –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            text-align: center;
            color: white;
        }
        
        .start-screen h1 {
            font-size: 42px;
            margin-bottom: 10px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .start-screen h2 {
            font-size: 24px;
            margin-bottom: 40px;
            opacity: 0.95;
            font-weight: 400;
        }
        
        .mode-selector {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 350px;
        }
        
        .mode-btn {
            background: rgba(255,255,255,0.95);
            color: #333;
            border: none;
            padding: 25px 30px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .mode-btn .icon {
            font-size: 40px;
        }
        
        .mode-btn .text {
            display: flex;
            flex-direction: column;
        }
        
        .mode-btn .text small {
            font-size: 13px;
            font-weight: 400;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        .instructions {
            margin-top: 40px;
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 15px;
            max-width: 350px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .instructions ol {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            z-index: 100;
        }
        
        .location-info h1 {
            font-size: 22px;
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .location-info p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .close-btn {
            width: 44px;
            height: 44px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .bottom-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            z-index: 100;
        }
        
        /* AR –ö–∞—Ä—Ç–æ—á–∫–∞ */
        .ar-card {
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 24px;
            color: white;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            animation: slideUp 0.4s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .ar-card .year {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 6px 18px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 12px;
        }
        
        .ar-card h3 {
            font-size: 22px;
            margin-bottom: 10px;
        }
        
        .ar-card p {
            font-size: 15px;
            line-height: 1.5;
            opacity: 0.95;
        }
        
        /* –ú–µ–Ω—é */
        .bottom-menu {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .menu-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }
        
        .menu-btn:active {
            transform: scale(0.95);
        }
        
        .menu-btn.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            width: 64px;
            height: 64px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.5);
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */
        .scanning-hint {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-align: center;
            background: rgba(0,0,0,0.7);
            padding: 20px 30px;
            border-radius: 20px;
            display: none;
        }
        
        .scanning-hint.active {
            display: block;
        }
        
        .scan-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            border: 3px solid rgba(102, 126, 234, 0.8);
            border-radius: 20px;
            box-shadow: 0 0 0 9999px rgba(0,0,0,0.5);
            display: none;
        }
        
        .scan-frame.active {
            display: block;
        }
        
        /* –õ–æ–∞–¥–µ—Ä */
        .loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            z-index: 1500;
            display: none;
        }
        
        .loader.active {
            display: block;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* GPS —Å—Ç–∞—Ç—É—Å */
        .gps-status {
            position: absolute;
            top: 80px;
            left: 20px;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            font-size: 14px;
            display: none;
        }
        
        .gps-status.active {
            display: block;
        }
        
        .gps-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #0f0;
            border-radius: 50%;
            margin-right: 8px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="start-screen" id="startScreen">
        <h1>üèõÔ∏è</h1>
        <h2>AR –û–ª—ë–∫–º–∏–Ω—Å–∫</h2>
        
        <div class="mode-selector">
            <button class="mode-btn" onclick="startMarkerMode()">
                <span class="icon">üì∑</span>
                <span class="text">
                    –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR
                    <small>–ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ QR-–∫–æ–¥ –Ω–∞ –∑–¥–∞–Ω–∏–∏</small>
                </span>
            </button>
            
            <button class="mode-btn" onclick="startGPSMode()">
                <span class="icon">üìç</span>
                <span class="text">
                    GPS –ù–∞–≤–∏–≥–∞—Ü–∏—è
                    <small>–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</small>
                </span>
            </button>
        </div>
        
        <div class="instructions">
            <h3>üì± –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</h3>
            <ol>
                <li>–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ</li>
                <li>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</li>
                <li>–ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ QR-–∫–æ–¥ –∏–ª–∏ –∏–¥–∏—Ç–µ –∫ –ª–æ–∫–∞—Ü–∏–∏</li>
                <li>–£–≤–∏–¥–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –≤ AR!</li>
            </ol>
        </div>
    </div>

    <!-- –õ–æ–∞–¥–µ—Ä -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <p id="loaderText">–ó–∞–≥—Ä—É–∑–∫–∞ AR...</p>
    </div>

    <!-- AR –°—Ü–µ–Ω–∞ -->
    <div id="ar-container" style="display: none;">
        <a-scene embedded 
                 arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix;"
                 renderer="logarithmicDepthBuffer: true;"
                 vr-mode-ui="enabled: false"
                 gesture-detector
                 id="arScene">
            
            <!-- –ö–∞–º–µ—Ä–∞ -->
            <a-entity camera></a-entity>
            
            <!-- –ú–∞—Ä–∫–µ—Ä 1: –î–æ–º –ö—É–ª—å—Ç—É—Ä—ã -->
            <a-marker type="barcode" value="1" id="marker-dk"
                     emitevents="true"
                     cursor="rayOrigin: mouse">
                <a-entity position="0 0 0">
                    <!-- 3D –ö–∞—Ä—Ç–æ—á–∫–∞ -->
                    <a-plane position="0 0.5 0" 
                             width="2" 
                             height="1.2" 
                             color="#000"
                             opacity="0.9"
                             material="shader: flat; transparent: true">
                        
                        <a-text value="–î–æ–º –ö—É–ª—å—Ç—É—Ä—ã\n1985 –≥–æ–¥" 
                               align="center" 
                               color="white" 
                               width="4"
                               position="0 0.2 0.01"></a-text>
                        
                        <a-text value="–ù–∞–≤–µ–¥–∏—Ç–µ —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å\n–∏—Å—Ç–æ—Ä–∏—é —ç—Ç–æ–≥–æ –º–µ—Å—Ç–∞" 
                               align="center" 
                               color="#AAA" 
                               width="3"
                               position="0 -0.2 0.01"></a-text>
                    </a-plane>
                    
                    <!-- –ò–∫–æ–Ω–∫–∞ -->
                    <a-entity position="0 1.5 0">
                        <a-sphere color="#667eea" radius="0.3"></a-sphere>
                        <a-text value="üèõÔ∏è" 
                               align="center" 
                               position="0 0 0.3"></a-text>
                    </a-entity>
                </a-entity>
            </a-marker>

            <!-- –ú–∞—Ä–∫–µ—Ä 2: –ù–∞–±–µ—Ä–µ–∂–Ω–∞—è -->
            <a-marker type="barcode" value="2" id="marker-nab"
                     emitevents="true">
                <a-entity position="0 0 0">
                    <a-plane position="0 0.5 0" 
                             width="2" 
                             height="1.2" 
                             color="#000"
                             opacity="0.9"
                             material="shader: flat; transparent: true">
                        
                        <a-text value="–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è –õ–µ–Ω—ã\n1970-–µ –≥–æ–¥—ã" 
                               align="center" 
                               color="white" 
                               width="4"
                               position="0 0.2 0.01"></a-text>
                        
                        <a-text value="–°—Ç–∞—Ä–∞—è –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è –≥–æ—Ä–æ–¥–∞" 
                               align="center" 
                               color="#AAA" 
                               width="3"
                               position="0 -0.2 0.01"></a-text>
                    </a-plane>
                    
                    <a-entity position="0 1.5 0">
                        <a-sphere color="#764ba2" radius="0.3"></a-sphere>
                        <a-text value="üåä" 
                               align="center" 
                               position="0 0 0.3"></a-text>
                    </a-entity>
                </a-entity>
            </a-marker>

            <!-- –ú–∞—Ä–∫–µ—Ä 3: –®–∫–æ–ª–∞ -->
            <a-marker type="barcode" value="3" id="marker-school"
                     emitevents="true">
                <a-entity position="0 0 0">
                    <a-plane position="0 0.5 0" 
                             width="2" 
                             height="1.2" 
                             color="#000"
                             opacity="0.9"
                             material="shader: flat; transparent: true">
                        
                        <a-text value="–®–∫–æ–ª–∞ ‚Ññ1\n1950-–µ –≥–æ–¥—ã" 
                               align="center" 
                               color="white" 
                               width="4"
                               position="0 0.2 0.01"></a-text>
                        
                        <a-text value="–ü–µ—Ä–≤–∞—è —à–∫–æ–ª–∞ –≥–æ—Ä–æ–¥–∞" 
                               align="center" 
                               color="#AAA" 
                               width="3"
                               position="0 -0.2 0.01"></a-text>
                    </a-plane>
                    
                    <a-entity position="0 1.5 0">
                        <a-sphere color="#f093fb" radius="0.3"></a-sphere>
                        <a-text value="üè´" 
                               align="center" 
                               position="0 0 0.3"></a-text>
                    </a-entity>
                </a-entity>
            </a-marker>
        </a-scene>
    </div>

    <!-- UI –û–≤–µ—Ä–ª–µ–π -->
    <div class="ui-overlay" id="uiOverlay" style="display: none;">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="top-bar">
            <div class="location-info">
                <h1 id="locationTitle">üèõÔ∏è –î–æ–º –ö—É–ª—å—Ç—É—Ä—ã</h1>
                <p id="locationSubtitle">üìç 50 –º –¥–æ –æ–±—ä–µ–∫—Ç–∞</p>
            </div>
            
            <button class="close-btn" onclick="closeAR()">√ó</button>
        </div>
        
        <!-- GPS –°—Ç–∞—Ç—É—Å -->
        <div class="gps-status" id="gpsStatus">
            <span class="gps-dot"></span>
            <span id="gpsText">–ü–æ–∏—Å–∫ GPS...</span>
        </div>
        
        <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div class="scanning-hint" id="scanningHint">
            <p>üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥</p>
        </div>
        
        <div class="scan-frame" id="scanFrame"></div>

        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="bottom-panel">
            <!-- AR –ö–∞—Ä—Ç–æ—á–∫–∞ -->
            <div class="ar-card" id="arCard" style="display: none;">
                <span class="year" id="cardYear">1985 –≥–æ–¥</span>
                <h3 id="cardTitle">–î–æ–º –ö—É–ª—å—Ç—É—Ä—ã ¬´–ì–∞—Ä–º–æ–Ω–∏—è¬ª</h3>
                <p id="cardText">–í 1980-–µ –≥–æ–¥—ã –î–æ–º –ö—É–ª—å—Ç—É—Ä—ã –±—ã–ª —Ü–µ–Ω—Ç—Ä–æ–º –∫—É–ª—å—Ç—É—Ä–Ω–æ–π –∂–∏–∑–Ω–∏ –≥–æ—Ä–æ–¥–∞. –ó–¥–µ—Å—å –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –∫–æ–Ω—Ü–µ—Ä—Ç—ã, —Ç–µ–∞—Ç—Ä–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–µ –≤–µ—á–µ—Ä—ã.</p>
            </div>
            
            <!-- –ú–µ–Ω—é -->
            <div class="bottom-menu">
                <button class="menu-btn" onclick="prevLocation()" title="–ù–∞–∑–∞–¥">‚¨ÖÔ∏è</button>
                
                <button class="menu-btn" onclick="toggleQuest()" title="–ö–≤–µ—Å—Ç">üéØ</button>
                
                <button class="menu-btn primary" onclick="capturePhoto()" title="–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ">üì∏</button>
                
                <button class="menu-btn" onclick="shareLocation()" title="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è">üì§</button>
                
                <button class="menu-btn" onclick="nextLocation()" title="–í–ø–µ—Ä–µ–¥">‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–π
        const locations = [
            {
                id: 'dk',
                name: '–î–æ–º –ö—É–ª—å—Ç—É—Ä—ã ¬´–ì–∞—Ä–º–æ–Ω–∏—è¬ª',
                year: '1985',
                description: '–í 1980-–µ –≥–æ–¥—ã –î–æ–º –ö—É–ª—å—Ç—É—Ä—ã –±—ã–ª —Ü–µ–Ω—Ç—Ä–æ–º –∫—É–ª—å—Ç—É—Ä–Ω–æ–π –∂–∏–∑–Ω–∏ –≥–æ—Ä–æ–¥–∞. –ó–¥–µ—Å—å –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –∫–æ–Ω—Ü–µ—Ä—Ç—ã, —Ç–µ–∞—Ç—Ä–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–µ –≤–µ—á–µ—Ä—ã.',
                markerId: 'marker-dk',
                coords: { lat: 60.366, lng: 120.416 }
            },
            {
                id: 'nab',
                name: '–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è –õ–µ–Ω—ã',
                year: '1970',
                description: '–°—Ç–∞—Ä–∞—è –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è –¥–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π. –ó–¥–µ—Å—å –ø—Ä–æ–≤–æ–¥–∏–ª–∏—Å—å –≥–æ—Ä–æ–¥—Å–∫–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏, —Å–æ–±—Ä–∞–Ω–∏—è –∏ –Ω–∞—Ä–æ–¥–Ω—ã–µ –≥—É–ª—è–Ω–∏—è.',
                markerId: 'marker-nab',
                coords: { lat: 60.367, lng: 120.418 }
            },
            {
                id: 'school',
                name: '–®–∫–æ–ª–∞ ‚Ññ1 –∏–º. –Ø–∫–æ–≤–ª–µ–≤–∞',
                year: '1950',
                description: '–ü–µ—Ä–≤–∞—è —à–∫–æ–ª–∞ –≥–æ—Ä–æ–¥–∞, –æ—Å–Ω–æ–≤–∞–Ω–∞ –≤ 1930-—Ö –≥–æ–¥–∞—Ö. –í—ã–ø—É—Å—Ç–∏–ª–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∂–∏—Ç–µ–ª–µ–π –û–ª—ë–∫–º–∏–Ω—Å–∫–∞ –∏ –≤–Ω–µ—Å–ª–∞ –±–æ–ª—å—à–æ–π –≤–∫–ª–∞–¥ –≤ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ.',
                markerId: 'marker-school',
                coords: { lat: 60.368, lng: 120.415 }
            }
        ];

        let currentMode = null;
        let currentLocation = 0;
        let watchId = null;

        // –†–µ–∂–∏–º QR-—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        function startMarkerMode() {
            currentMode = 'marker';
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('loader').classList.add('active');
            document.getElementById('loaderText').textContent = '–ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã...';
            
            setTimeout(() => {
                document.getElementById('loader').classList.remove('active');
                document.getElementById('ar-container').style.display = 'block';
                document.getElementById('uiOverlay').style.display = 'block';
                document.getElementById('scanningHint').classList.add('active');
                document.getElementById('scanFrame').classList.add('active');
                
                initMarkers();
            }, 1500);
        }

        // –†–µ–∂–∏–º GPS
        function startGPSMode() {
            currentMode = 'gps';
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('loader').classList.add('active');
            document.getElementById('loaderText').textContent = '–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...';
            
            if (navigator.geolocation) {
                document.getElementById('gpsStatus').classList.add('active');
                
                watchId = navigator.geolocation.watchPosition(
                    handleGPSPosition,
                    handleGPSError,
                    { enableHighAccuracy: true, maximumAge: 5000, timeout: 10000 }
                );
                
                setTimeout(() => {
                    document.getElementById('loader').classList.remove('active');
                    document.getElementById('ar-container').style.display = 'block';
                    document.getElementById('uiOverlay').style.display = 'block';
                }, 2000);
            } else {
                alert('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                document.getElementById('loader').classList.remove('active');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤
        function initMarkers() {
            locations.forEach((loc, index) => {
                const marker = document.getElementById(loc.markerId);
                if (marker) {
                    marker.addEventListener('markerFound', () => {
                        console.log('–ú–∞—Ä–∫–µ—Ä –Ω–∞–π–¥–µ–Ω:', loc.name);
                        showLocation(index);
                    });
                    
                    marker.addEventListener('markerLost', () => {
                        console.log('–ú–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω:', loc.name);
                        hideCard();
                    });
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ GPS
        function handleGPSPosition(position) {
            const { latitude, longitude } = position.coords;
            
            let minDist = Infinity;
            let nearestIdx = 0;
            
            locations.forEach((loc, idx) => {
                const dist = calculateDistance(latitude, longitude, loc.coords.lat, loc.coords.lng);
                if (dist < minDist) {
                    minDist = dist;
                    nearestIdx = idx;
                }
            });
            
            const distMeters = Math.round(minDist * 1000);
            document.getElementById('gpsText').textContent = `${distMeters} –º –¥–æ ${locations[nearestIdx].name}`;
            document.getElementById('locationSubtitle').textContent = `üìç ${distMeters} –º –¥–æ –æ–±—ä–µ–∫—Ç–∞`;
            
            if (distMeters < 100 && currentLocation !== nearestIdx) {
                currentLocation = nearestIdx;
                showLocation(nearestIdx);
            }
        }

        function handleGPSError(error) {
            console.warn('GPS –æ—à–∏–±–∫–∞:', error);
            document.getElementById('gpsText').textContent = 'GPS –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
        }

        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é
        function showLocation(index) {
            const loc = locations[index];
            document.getElementById('cardYear').textContent = loc.year + ' –≥–æ–¥';
            document.getElementById('cardTitle').textContent = loc.name;
            document.getElementById('cardText').textContent = loc.description;
            document.getElementById('locationTitle').textContent = 'üèõÔ∏è ' + loc.name;
            document.getElementById('arCard').style.display = 'block';
            
            document.getElementById('scanningHint').classList.remove('active');
            document.getElementById('scanFrame').classList.remove('active');
        }

        function hideCard() {
            document.getElementById('arCard').style.display = 'none';
            if (currentMode === 'marker') {
                document.getElementById('scanningHint').classList.add('active');
                document.getElementById('scanFrame').classList.add('active');
            }
        }

        // UI –§—É–Ω–∫—Ü–∏–∏
        function toggleQuest() {
            const loc = locations[currentLocation];
            const questions = {
                'dk': '–í –∫–∞–∫–æ–º –≥–æ–¥—É –ø–æ—Å—Ç—Ä–æ–µ–Ω –î–æ–º –ö—É–ª—å—Ç—É—Ä—ã?',
                'nab': '–ö–∞–∫–∞—è —Ä–µ–∫–∞ –ø—Ä–æ—Ç–µ–∫–∞–µ—Ç —Ä—è–¥–æ–º?',
                'school': '–ö–∞–∫–æ–π –Ω–æ–º–µ—Ä —É —ç—Ç–æ–π —à–∫–æ–ª—ã?'
            };
            alert('üéØ ' + questions[loc.id]);
        }

        function capturePhoto() {
            alert('üì∏ –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å!\n\n#AR–û–ª—ë–∫–º–∏–Ω—Å–∫ #–ú–æ—è–û–ª—ë–∫–º–∞ #–ò—Å—Ç–æ—Ä–∏—è–û–ª—ë–∫–º–∏–Ω—Å–∫–∞');
        }

        function shareLocation() {
            const loc = locations[currentLocation];
            if (navigator.share) {
                navigator.share({
                    title: loc.name,
                    text: `–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ AR-—ç–∫—Å–∫—É—Ä—Å–∏—é: ${loc.name}`,
                    url: window.location.href
                });
            } else {
                alert('–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É:\n' + window.location.href);
            }
        }

        function nextLocation() {
            currentLocation = (currentLocation + 1) % locations.length;
            showLocation(currentLocation);
        }

        function prevLocation() {
            currentLocation = (currentLocation - 1 + locations.length) % locations.length;
            showLocation(currentLocation);
        }

        function closeAR() {
            if (confirm('–ó–∞–≤–µ—Ä—à–∏—Ç—å —ç–∫—Å–∫—É—Ä—Å–∏—é?')) {
                if (watchId) {
                    navigator.geolocation.clearWatch(watchId);
                }
                location.reload();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                window.dispatchEvent(new Event('resize'));
            }, 300);
        });
    </script>
</body>
</html>